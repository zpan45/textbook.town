<html>
<head>
    <title>Place a Bid</title>
    <!-- Import JS/CSS System Wide Libs -->
    <!-- Required Global Libs | Full List Maintained in: components/head.html, however HTML import does not exist right now so we need to copy paste, nick researched this for 2 hours with Mark. -->
    <!-- JS -->
    <script src="js/mustache.min.js"></script>
    <script src="js/core.js"></script>

    <!-- JS Lib -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="css/core.css">

    <!-- FONT --><!-- TODO: reduce font weight use before production. -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Josefin+Sans:100,100i,300,300i,400,400i,600,600i,700,700i" rel="stylesheet">

    <style>
        /*table, th, td {*/
        /*border: 1px solid black;*/
        /*}*/

        form {
            margin: auto;
            position: relative;
            width: 1100px;
            height: 1100px;
            background-color: white;
            text-decoration: none;
            border-radius: 10px;
            padding: 10px;
            border: 1px solid #999;
            border: inset 1px solid #333;
            -webkit-box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.3);
            -moz-box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.3);
            box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.3);
        }

    </style>
</head>

<body>
<div id="top"></div>
<br>
<form>

    <table align="center" style="width:92%; border-bottom: 1px solid #d84c4c; margin-bottom: 20px;">
        <tr>
            <th style="width:100%; height: 0px">
                <div id="title"></div>
            </th>
        </tr>
    </table>

    <table align="center" style="width:92%; margin-bottom: 20px ">
        <tr>
            <th style="width:35%; ">
                <div id="img01"></div>
            </th>

            <th style="width:65%; vertical-align: top; text-align: left">
                <div id="info01"></div>
            </th>
        </tr>
    </table>
    <table align="center" style="width:92%; margin-bottom: 20px">
        <tr>
            <th>
                <div id="userbidbutton" style="float: right;">
                            <span class="form-field">
                            <input type="submit" name="postBid" id="postBid" class="button" value="Place Bid" style="width:100px">
                            </span>
                </div>
                <div id="userbidinput" style="float: right">
                            <span class="form-field">
                            <input name="bid" id="bidinput" type="number" value="" size="40" aria-required="true" style="width:170px">
                            </span>
                </div>

            </th>
        </tr>
    </table>
    <div style="margin: auto;
            position: relative;
            width: 1000px;
            height: 460px;
            background-color: #eaf6f7;
            text-decoration: none;
            border-radius: 10px;
            padding: 10px;
            border: 1px solid #999;
            border: inset 1px solid #333;
            -webkit-box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.3);
            -moz-box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.3);
            box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.3);">
        <table style="width:100%;">
            <tr>
                <th >
                    <div id="image1"></div>
                </th>
            </tr>
        </table>

    </div>
    </table>

</form>
</body>

<script type="text/javascript">
////
// Page Render
//
$(function() {

    var id = getQueryVariable("id");
    var info = '';
    var hasbid = false;
    var isbuyer = true;
    token = getCookie("session");

    if ( token != null){
       	$.ajax({
		    type: 'GET',
		    url: 'http://127.0.0.1:5000/book/buyercheck?id=' + id,
		    headers: {
			    "Authorization": "Basic " + btoa(token + ":" + "")
  		    },
		    success: function(res){
			    //Parse reply data
			    if(res.status == 'success'){
                    isbuyer = res.isBuyer;
                    console.log(isbuyer)
			    }

		    }
	    });
    }


    $.ajax({
		type: 'GET',
		url: 'http://127.0.0.1:5000/book/hasbid?id='+id,
		headers: {
			"Authorization": "Basic " + btoa(token + ":" + "")
  		},
		success: function(res){
			//Parse reply data
			if(res.status == 'success'){
                hasbid = res.hasBid;
                console.log(hasbid)
			}

		}
	});

    if (isbuyer == false){
         // redirect to Nicole's page and pass ID
         window.location.replace("index.html");
    }

    console.log(id)

    $.ajax({
    type: 'GET',
    url: 'http://127.0.0.1:5000/book/info?id='+id,   

    success: function(res){
      //Parse reply data

      if(res.status == 'success'){
                info = res;
                console.log(info.coverPhoto)
      }
      // Some sort of weird failure--shouldn't happen if people are using the website properly
      else {
          // alert(res.message)
          window.location.replace("dashboard.html")
      }

    }
  });

	//Render Top
	Promise.resolve(render("#top", "tp/head.html", {title: "Place a Bid:"})).then(
    	menu()
	);

	// info
    render("#info", "tp/bookInfo.html", {
    	title: "Book Information",
    	t_bg:"#FFFFFF",
    	t_c: "#C5494C",
    	img: info.coverPhoto,
    	side: info.title,
    	side_2: "by: "+info.author,
    	side_3: "condition: "+info.condition,
    	side_4: "Auction Closes: "+info.closingDate,
    	side_5: "Minimum bad: "+info.minimumBid

    });

    if (hasbid == false){
        render("#userbid", "tp/bidform.html");
    }
    if (hasbid == true){
        render("#userbid", "tp/havebid.html");
    }

    // images
    render("#images", "tp/threeImg.html", {
        title: "Pictures of the Book",
        first: info.bestPhoto,
        second: info.averagePhoto,
        third: info.worstPhoto
    });

            first: "img/213kh12kj312k3h1khj3jk12hkj31.png",
            second: "img/213kh12kj312k3h1khj3jk12hkj31.png",
            third: "img/213kh12kj312k3h1khj3jk12hkj31.png"
        });



    });

</script>
</html>
