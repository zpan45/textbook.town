<!DOCTYPE html>
<html>

<!-- Page Wide Settings -->
<head>

	<!-- Page Title -->
	<title>Textbook Town - Make Your Sale</title>

	<!-- Import JS/CSS System Wide Libs -->
	<!-- Required Global Libs | Full List Maintained in: components/head.html, however HTML import does not exist right now so we need to copy paste, nick researched this for 2 hours with Mark. -->
		<!-- JS -->
		<script src="js/mustache.min.js"></script>
		<script src="js/core.js"></script>

		<!-- JS Lib -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

		<!-- CSS -->
		<link rel="stylesheet" type="text/css" href="css/core.css">

		<!-- FONT --><!-- TODO: reduce font weight use before production. -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Josefin+Sans:100,100i,300,300i,400,400i,600,600i,700,700i" rel="stylesheet">

</head>

<!-- Client Facing Content-->
<body>

	<!-- Menu and Top Section Container -->
	<div id="top"></div>

	<!-- Display Books -->
	<div id="bidList"></div>
</body>
</html>

<script type="text/javascript">

////
// Page Render
//
$(function() {

	//Chained rendering for nested items
	Promise.resolve(render("#top", "tp/head.html", {title: "Auction Results:"})).then(
    	menu()
	);

	// need to pass the token in the header with our request
	token = getCookie("session");

	// Data grab to get everything that we'll be displaying
	$.ajax({
		type: 'GET',
    	url: 'http://127.0.0.1:5000/book/sellerInfo?id=' + 7,	// THIS IS HARD-CODED FOR NOW-- WE NEED TO GET THE ID, probably from the redirect?
    	headers: {
     		"Authorization": "Basic " + btoa(token + ":" + "")
        },

        success: function(data){
			if(data.status == 'success'){
				if(!data.isCurrent) {
					// If auction has closed, we need to display the top bidders
					// Could be 0-3 bids -- right now they get rendered like the search result books, we need to change that

					renderTopBids(data.bids); 
				}
			}
			// status = failure, let user know why
			else {
				alert(data.message)
			}
		},

		// If 401 error because user isn't allowed to access the page, redirect to login
		error: function(res){
			if(res.status == 401){
				window.location.replace("login.html");
			}
    }
	});

});
</script>
